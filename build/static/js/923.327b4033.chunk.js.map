{"version":3,"file":"static/js/923.327b4033.chunk.js","mappings":"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","sources":["admin/LoveFeelingCodeAdmin.jsx","pages/AdminDashboard.jsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\nimport { supabase } from \"../lib/supabaseClient\";\r\nimport \"./LoveCodeAdmin.css\"; // âœ… å¯å¤ç”¨åŒæ ·æ ·å¼\r\n\r\nexport default function LoveFeelingCodeAdmin() {\r\n  const [codes, setCodes] = useState([]);\r\n  const [filter, setFilter] = useState(\"all\");\r\n  const [loading, setLoading] = useState(false);\r\n  const [newCount, setNewCount] = useState(10);\r\n  const [message, setMessage] = useState(\"\");\r\n\r\n  async function loadCodes() {\r\n    try {\r\n      setLoading(true);\r\n      let query = supabase\r\n        .from(\"love_feeling_access_codes\")\r\n        .select(\"*\")\r\n        .order(\"created_at\", { ascending: false });\r\n\r\n      if (filter === \"unused\") query = query.eq(\"is_used\", false);\r\n      if (filter === \"used\") query = query.eq(\"is_used\", true);\r\n\r\n      const { data, error } = await query;\r\n\r\n      if (error) {\r\n        console.error(\"âŒ Supabase æŸ¥è¯¢å¤±è´¥:\", error.message);\r\n        setMessage(\"âš ï¸ æƒé™ä¸è¶³æˆ–åŠ è½½å¤±è´¥ï¼š\" + error.message);\r\n        setCodes([]);\r\n      } else {\r\n        setCodes(data || []);\r\n      }\r\n    } catch (err) {\r\n      console.error(\"ğŸ’¥ å¼‚å¸¸:\", err);\r\n      setMessage(\"ğŸ’¥ åŠ è½½å‡ºé”™ï¼š\" + err.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    loadCodes();\r\n  }, [filter]);\r\n\r\n  async function generateCodes() {\r\n    try {\r\n      setLoading(true);\r\n      const { data, error } = await supabase.functions.invoke(\"generate-love-feeling-codes\", {\r\n        body: JSON.stringify({ count: newCount }),\r\n      });\r\n\r\n      if (error) {\r\n        console.error(\"âŒ ç”Ÿæˆå¤±è´¥:\", error.message);\r\n        setMessage(\"âŒ ç”Ÿæˆå¤±è´¥ï¼š\" + error.message);\r\n      } else {\r\n        setMessage(`âœ… å·²ç”Ÿæˆ ${newCount} ä¸ªå–œæ¬¢æµ‹è¯•å…‘æ¢ç `);\r\n        await loadCodes();\r\n      }\r\n    } catch (err) {\r\n      console.error(\"ğŸ’¥ è°ƒç”¨å‡½æ•°å¤±è´¥:\", err);\r\n      setMessage(\"ğŸ’¥ ç½‘ç»œæˆ–å‡½æ•°é”™è¯¯ï¼š\" + err.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  function exportCSV() {\r\n    const csv = [\r\n      [\"code\", \"price\", \"discount_price\", \"is_used\", \"used_at\"].join(\",\"),\r\n      ...codes.map((c) =>\r\n        [c.code, c.price, c.discount_price, c.is_used, c.used_at || \"\"].join(\",\")\r\n      ),\r\n    ].join(\"\\n\");\r\n\r\n    const blob = new Blob([csv], { type: \"text/csv\" });\r\n    const link = document.createElement(\"a\");\r\n    link.href = URL.createObjectURL(blob);\r\n    link.download = \"love_feeling_access_codes.csv\";\r\n    link.click();\r\n  }\r\n\r\n  return (\r\n    <div className=\"love-admin\">\r\n      <h2>ğŸ’ å–œæ¬¢æµ‹è¯•å…‘æ¢ç ç®¡ç†</h2>\r\n\r\n      <div className=\"actions\">\r\n        <select value={filter} onChange={(e) => setFilter(e.target.value)}>\r\n          <option value=\"all\">å…¨éƒ¨</option>\r\n          <option value=\"unused\">æœªä½¿ç”¨</option>\r\n          <option value=\"used\">å·²ä½¿ç”¨</option>\r\n        </select>\r\n\r\n        <input\r\n          type=\"number\"\r\n          min=\"1\"\r\n          max=\"100\"\r\n          value={newCount}\r\n          onChange={(e) => setNewCount(Number(e.target.value))}\r\n        />\r\n        <button onClick={generateCodes} disabled={loading}>\r\n          âš¡ ç”Ÿæˆå…‘æ¢ç \r\n        </button>\r\n        <button onClick={exportCSV}>ğŸ“¤ å¯¼å‡º CSV</button>\r\n      </div>\r\n\r\n      {message && <p className=\"message\">{message}</p>}\r\n      {loading && <p>åŠ è½½ä¸­...</p>}\r\n\r\n      {!loading && codes.length > 0 && (\r\n        <table className=\"code-table\">\r\n          <thead>\r\n            <tr>\r\n              <th>å…‘æ¢ç </th>\r\n              <th>åŸä»·</th>\r\n              <th>ä¼˜æƒ ä»·</th>\r\n              <th>çŠ¶æ€</th>\r\n              <th>ä½¿ç”¨æ—¶é—´</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {codes.map((c) => (\r\n              <tr key={c.code} className={c.is_used ? \"used\" : \"unused\"}>\r\n                <td>{c.code}</td>\r\n                <td>{c.price}</td>\r\n                <td>{c.discount_price}</td>\r\n                <td>{c.is_used ? \"âœ… å·²ç”¨\" : \"ğŸ•“ æœªç”¨\"}</td>\r\n                <td>{c.used_at ? new Date(c.used_at).toLocaleString() : \"-\"}</td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import { useState, useEffect, lazy, Suspense } from \"react\";\r\nimport { supabase } from \"../lib/supabaseClient\";\r\nimport LoveFeelingCodeAdmin from \"../admin/LoveFeelingCodeAdmin\"; // ğŸ’ æ–°å¢å–œæ¬¢æµ‹è¯•å…‘æ¢ç ç®¡ç†é¡µ\r\n\r\n// åŸæœ‰æ¨¡å—å»¶è¿ŸåŠ è½½\r\nconst LoveCodeAdmin = lazy(() => import(\"../admin/LoveCodeAdmin\"));\r\nconst LoveOrdersAdmin = lazy(() => import(\"../admin/LoveOrdersAdmin\"));\r\n\r\nexport default function AdminDashboard() {\r\n  const [user, setUser] = useState(null);\r\n  const [tab, setTab] = useState(\"codes\");\r\n\r\n  // âœ… æ£€æŸ¥ç™»å½•ä¸ç®¡ç†å‘˜æƒé™\r\n  useEffect(() => {\r\n    (async () => {\r\n      const { data } = await supabase.auth.getUser();\r\n\r\n      if (!data?.user) {\r\n        alert(\"è¯·å…ˆç™»å½•\");\r\n        window.location.href = \"/\";\r\n        return;\r\n      }\r\n\r\n      // æŸ¥è¯¢ç”¨æˆ·è§’è‰²\r\n      const { data: profile, error } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"role\")\r\n        .eq(\"id\", data.user.id)\r\n        .maybeSingle();\r\n\r\n      if (error) {\r\n        console.error(\"âŒ è·å–ç”¨æˆ·è§’è‰²å¤±è´¥ï¼š\", error.message);\r\n      }\r\n\r\n      if (profile?.role !== \"admin\") {\r\n        alert(\"âŒ æ‚¨æ²¡æœ‰è®¿é—®åå°çš„æƒé™\");\r\n        window.location.href = \"/\";\r\n        return;\r\n      }\r\n\r\n      setUser(data.user);\r\n    })();\r\n  }, []);\r\n\r\n  if (!user) return <p style={{ textAlign: \"center\" }}>æ­£åœ¨éªŒè¯æƒé™...</p>;\r\n\r\n  // âœ… é¡µé¢ä¸»ä½“\r\n  return (\r\n    <div className=\"admin-dashboard\">\r\n      <h2>ğŸ’¼ ç®¡ç†åå°</h2>\r\n\r\n      {/* -----------------------------\r\n      ğŸ§­ åå°å¯¼èˆªæ ‡ç­¾\r\n      ------------------------------ */}\r\n      <div className=\"tabs\">\r\n        <button\r\n          className={tab === \"codes\" ? \"active\" : \"\"}\r\n          onClick={() => setTab(\"codes\")}\r\n        >\r\n          ğŸ å æœ‰æ¬²æµ‹è¯•å…‘æ¢ç \r\n        </button>\r\n\r\n        <button\r\n          className={tab === \"loveFeelingCodes\" ? \"active\" : \"\"}\r\n          onClick={() => setTab(\"loveFeelingCodes\")}\r\n        >\r\n          ğŸ’ å–œæ¬¢æµ‹è¯•å…‘æ¢ç \r\n        </button>\r\n\r\n        <button\r\n          className={tab === \"orders\" ? \"active\" : \"\"}\r\n          onClick={() => setTab(\"orders\")}\r\n        >\r\n          ğŸ“¦ è®¢å•ç®¡ç†\r\n        </button>\r\n      </div>\r\n\r\n      {/* -----------------------------\r\n      ğŸ§© å†…å®¹åŒºï¼ˆæ‡’åŠ è½½ç»„ä»¶ï¼‰\r\n      ------------------------------ */}\r\n      <Suspense fallback={<p style={{ textAlign: \"center\" }}>åŠ è½½ä¸­...</p>}>\r\n        {tab === \"codes\" && <LoveCodeAdmin />}\r\n        {tab === \"loveFeelingCodes\" && <LoveFeelingCodeAdmin />}\r\n        {tab === \"orders\" && <LoveOrdersAdmin />}\r\n      </Suspense>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["LoveFeelingCodeAdmin","codes","setCodes","useState","filter","setFilter","loading","setLoading","newCount","setNewCount","message","setMessage","async","loadCodes","query","supabase","from","select","order","ascending","eq","data","error","console","err","useEffect","_jsxs","className","children","_jsx","value","onChange","e","target","type","min","max","Number","onClick","functions","invoke","body","JSON","stringify","count","concat","disabled","csv","join","map","c","code","price","discount_price","is_used","used_at","blob","Blob","link","document","createElement","href","URL","createObjectURL","download","click","length","Date","toLocaleString","LoveCodeAdmin","lazy","LoveOrdersAdmin","AdminDashboard","user","setUser","tab","setTab","auth","getUser","alert","window","location","profile","id","maybeSingle","role","Suspense","fallback","style","textAlign"],"sourceRoot":""}