"use strict";(self.webpackChunkpositive_energy_app=self.webpackChunkpositive_energy_app||[]).push([[277],{277:(e,s,c)=>{c.r(s),c.d(s,{default:()=>i});var n=c(890),t=c(74),a=(c(130),c(602));function i(){const[e,s]=(0,n.useState)([]),[c,i]=(0,n.useState)("all"),[d,r]=(0,n.useState)(!1),[l,o]=(0,n.useState)(10),[u,h]=(0,n.useState)("");async function j(){try{r(!0);let e=t.N.from("love_access_codes").select("*").order("created_at",{ascending:!1});"unused"===c&&(e=e.eq("is_used",!1)),"used"===c&&(e=e.eq("is_used",!0));const{data:n,error:a}=await e;a?(console.error("\u274c Supabase \u67e5\u8be2\u5931\u8d25:",a.message),h("\u26a0\ufe0f \u6743\u9650\u4e0d\u8db3\u6216\u52a0\u8f7d\u5931\u8d25\uff1a"+a.message),s([])):s(n||[])}catch(e){console.error("\ud83d\udca5 \u4ee3\u7801\u5f02\u5e38:",e),h("\ud83d\udca5 \u52a0\u8f7d\u65f6\u51fa\u9519\uff1a"+e.message)}finally{r(!1)}}return(0,n.useEffect)(()=>{j()},[c]),(0,a.jsxs)("div",{className:"love-admin",children:[(0,a.jsx)("h2",{children:"\ud83d\udc98 \u5151\u6362\u7801\u7ba1\u7406\u9762\u677f"}),(0,a.jsxs)("div",{className:"actions",children:[(0,a.jsxs)("select",{value:c,onChange:e=>i(e.target.value),children:[(0,a.jsx)("option",{value:"all",children:"\u5168\u90e8"}),(0,a.jsx)("option",{value:"unused",children:"\u672a\u4f7f\u7528"}),(0,a.jsx)("option",{value:"used",children:"\u5df2\u4f7f\u7528"})]}),(0,a.jsx)("input",{type:"number",min:"1",max:"100",value:l,onChange:e=>o(Number(e.target.value))}),(0,a.jsx)("button",{onClick:async function(){try{r(!0);const{data:e,error:s}=await t.N.functions.invoke("generate-love-codes",{body:JSON.stringify({count:l})});s?(console.error("\u274c \u751f\u6210\u5931\u8d25:",s.message),h("\u274c \u751f\u6210\u5931\u8d25\uff1a"+s.message)):(h("\u2705 \u5df2\u751f\u6210 ".concat(l," \u4e2a\u5151\u6362\u7801")),await j())}catch(e){console.error("\ud83d\udca5 \u8c03\u7528 Edge Function \u5931\u8d25:",e),h("\ud83d\udca5 \u7f51\u7edc\u6216\u51fd\u6570\u9519\u8bef\uff1a"+e.message)}finally{r(!1)}},disabled:d,children:"\u26a1 \u751f\u6210\u5151\u6362\u7801"}),(0,a.jsx)("button",{onClick:function(){const s=[["code","price","discount_price","is_used","used_at"].join(","),...e.map(e=>[e.code,e.price,e.discount_price,e.is_used,e.used_at||""].join(","))].join("\n"),c=new Blob([s],{type:"text/csv"}),n=document.createElement("a");n.href=URL.createObjectURL(c),n.download="love_access_codes.csv",n.click()},children:"\ud83d\udce4 \u5bfc\u51fa CSV"})]}),u&&(0,a.jsx)("p",{className:"message",children:u}),d&&(0,a.jsx)("p",{children:"\u52a0\u8f7d\u4e2d..."}),!d&&e.length>0&&(0,a.jsxs)("table",{className:"code-table",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"\u5151\u6362\u7801"}),(0,a.jsx)("th",{children:"\u539f\u4ef7"}),(0,a.jsx)("th",{children:"\u4f18\u60e0\u4ef7"}),(0,a.jsx)("th",{children:"\u72b6\u6001"}),(0,a.jsx)("th",{children:"\u4f7f\u7528\u65f6\u95f4"})]})}),(0,a.jsx)("tbody",{children:e.map(e=>(0,a.jsxs)("tr",{className:e.is_used?"used":"unused",children:[(0,a.jsx)("td",{children:e.code}),(0,a.jsx)("td",{children:e.price}),(0,a.jsx)("td",{children:e.discount_price}),(0,a.jsx)("td",{children:e.is_used?"\u2705 \u5df2\u7528":"\ud83d\udd53 \u672a\u7528"}),(0,a.jsx)("td",{children:e.used_at?new Date(e.used_at).toLocaleString():"-"})]},e.code))})]})]})}}}]);
//# sourceMappingURL=277.a70c33e0.chunk.js.map