{"version":3,"file":"static/js/25.e4e2172b.chunk.js","mappings":"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","sources":["components/TalentTest.jsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport { supabase } from \"../lib/supabaseClient\";\r\nimport fullQuestions from \"../data/talentQuestions.json\";\r\nimport \"./TalentTest.css\";\r\n\r\n// âœ… éšæœºæŠ½é¢˜\r\nfunction getRandomQuestions(count = 10) {\r\n  return fullQuestions.sort(() => 0.5 - Math.random()).slice(0, count);\r\n}\r\n\r\n// âœ… å¤©èµ‹ç±»å‹è¯´æ˜\r\nfunction getTalentDescription(type) {\r\n  const descMap = {\r\n    \"åˆ›é€ åŠ›\": `ğŸŒˆ **åˆ›é€ åŠ›å‹**  \r\nä½ æ˜¯å¤©ç”Ÿçš„çµæ„Ÿåˆ¶é€ æœº...ï¼ˆä»¥ä¸‹çœç•¥ç›¸åŒå†…å®¹ï¼‰`,\r\n    \"é€»è¾‘åŠ›\": `ğŸ§  **é€»è¾‘åˆ†æå‹**  \r\nä½ æ‹¥æœ‰å†·é™è€Œç²¾å‡†çš„æ€ç»´ç³»ç»Ÿ...`,\r\n    \"é¢†å¯¼åŠ›\": `ğŸ”¥ **é¢†å¯¼é©±åŠ¨å‹**  \r\nä½ å…·å¤‡å¼ºå¤§çš„å·å¬åŠ›...`,\r\n    \"å…±æƒ…åŠ›\": `ğŸ’ **å…±æƒ…æ²»æ„ˆå‹**  \r\nä½ æƒ…æ„Ÿä¸°å¯Œã€æ„Ÿå—åŠ›ç»†è…»...`,\r\n    \"å¤šå…ƒèåˆå‹\": `ğŸ’« **å¤šå…ƒèåˆå‹å¤©èµ‹**  \r\nä½ å…¼å…·ç†æ€§ã€åˆ›é€ ã€æƒ…æ„Ÿä¸æ´å¯Ÿ...`,\r\n  };\r\n  return descMap[type] || descMap[\"å¤šå…ƒèåˆå‹\"];\r\n}\r\n\r\nexport default function TalentTest({ onFinish }) {\r\n  // âœ… æ–°å¢å…‘æ¢ç ç›¸å…³çŠ¶æ€\r\n  const [redeemCode, setRedeemCode] = useState(\"\");\r\n  const [isVerified, setIsVerified] = useState(false);\r\n  const [checking, setChecking] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n\r\n  const [questions, setQuestions] = useState([]);\r\n  const [step, setStep] = useState(0);\r\n  const [scores, setScores] = useState({});\r\n  const [result, setResult] = useState(null);\r\n\r\n  // âœ… æ ¸éªŒå…‘æ¢ç \r\n  const handleVerify = async () => {\r\n    if (!redeemCode.trim()) return setError(\"è¯·è¾“å…¥å…‘æ¢ç \");\r\n    setChecking(true);\r\n    setError(\"\");\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"redeem_codes\")\r\n      .select(\"id, used, type\")\r\n      .eq(\"code\", redeemCode.trim())\r\n      .maybeSingle();\r\n\r\n    setChecking(false);\r\n\r\n    if (error) return setError(\"æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åå†è¯•\");\r\n    if (!data) return setError(\"å…‘æ¢ç æ— æ•ˆ\");\r\n    if (data.used) return setError(\"è¯¥å…‘æ¢ç å·²è¢«ä½¿ç”¨\");\r\n    if (data.type && data.type !== \"talent\" && data.type !== \"community_free\")\r\n      return setError(\"è¯¥å…‘æ¢ç ä¸èƒ½ç”¨äºæ­¤æµ‹è¯•\");\r\n\r\n    // âœ… éªŒè¯æˆåŠŸåæ ‡è®°å…‘æ¢ç ä¸ºå·²ä½¿ç”¨\r\n    await supabase.from(\"redeem_codes\").update({ used: true }).eq(\"code\", redeemCode.trim());\r\n\r\n    setIsVerified(true);\r\n    alert(\"ğŸ‰ éªŒè¯æˆåŠŸï¼å·²è§£é”å¤©èµ‹æ½œèƒ½æµ‹è¯•ã€‚\");\r\n  };\r\n\r\n  // âœ… åˆå§‹åŒ–é¢˜åº“ï¼ˆéªŒè¯æˆåŠŸåå†åŠ è½½ï¼‰\r\n  useEffect(() => {\r\n    if (!isVerified) return;\r\n    const todayKey = new Date().toISOString().split(\"T\")[0];\r\n    const cacheKey = `talentTest_${todayKey}`;\r\n    const cached = localStorage.getItem(cacheKey);\r\n    if (cached) {\r\n      setQuestions(JSON.parse(cached));\r\n    } else {\r\n      const selected = getRandomQuestions(10);\r\n      setQuestions(selected);\r\n      localStorage.setItem(cacheKey, JSON.stringify(selected));\r\n    }\r\n  }, [isVerified]);\r\n\r\n  // âœ… ç­”é¢˜é€»è¾‘\r\n  const handleAnswer = (type) => {\r\n    const newScores = { ...scores, [type]: (scores[type] || 0) + 1 };\r\n    setScores(newScores);\r\n\r\n    if (step + 1 < questions.length) {\r\n      setStep(step + 1);\r\n    } else {\r\n      generateResult(newScores);\r\n    }\r\n  };\r\n\r\n  // âœ… ç”Ÿæˆç»“æœå¹¶å†™å…¥ Supabase\r\n  const generateResult = async (finalScores) => {\r\n    const sorted = Object.entries(finalScores).sort((a, b) => b[1] - a[1]);\r\n    const topType = sorted[0]?.[0] || \"å¤šå…ƒèåˆå‹\";\r\n    const topScore = sorted[0]?.[1] ?? 0;\r\n    const second = sorted[1]?.[0];\r\n    const totalScore = Object.values(finalScores).reduce((a, b) => a + b, 0);\r\n\r\n    let typeLabel = topType;\r\n    if (second && topScore - finalScores[second] <= 1)\r\n      typeLabel = `${topType} + ${second} å¤åˆå‹`;\r\n\r\n    const description = getTalentDescription(topType);\r\n    const finalResult = { type: typeLabel, score: totalScore, description };\r\n    setResult(finalResult);\r\n\r\n    try {\r\n      const user = JSON.parse(localStorage.getItem(\"user\") || \"null\");\r\n      await supabase.from(\"talent_test_results\").insert({\r\n        user_email: user?.email || null,\r\n        type: typeLabel,\r\n        score: totalScore,\r\n        description,\r\n      });\r\n    } catch (err) {\r\n      console.error(\"âš ï¸ æ•°æ®å†™å…¥å¤±è´¥\", err);\r\n    }\r\n  };\r\n\r\n  // âœ… Step 1: è¾“å…¥å…‘æ¢ç ç•Œé¢\r\n  if (!isVerified) {\r\n    return (\r\n      <div className=\"redeem-container\">\r\n        <h2>ğŸŒŸ å¤©èµ‹æ½œèƒ½æµ‹è¯•</h2>\r\n        <p>è¯·è¾“å…¥å…‘æ¢ç ä»¥è§£é”æµ‹è¯•ï¼š</p>\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"è¾“å…¥å…‘æ¢ç \"\r\n          value={redeemCode}\r\n          onChange={(e) => setRedeemCode(e.target.value)}\r\n        />\r\n        <button onClick={handleVerify} disabled={checking}>\r\n          {checking ? \"éªŒè¯ä¸­...\" : \"ç«‹å³è§£é”\"}\r\n        </button>\r\n        {error && <p className=\"error-text\">{error}</p>}\r\n        <p className=\"hint\">\r\n          æ²¡æœ‰å…‘æ¢ç ï¼Ÿ<br />\r\n          <a\r\n            href=\"#\"\r\n            onClick={() =>\r\n              alert(\"è¯·å‰å¾€èƒ½é‡ç¤¾ç¾¤æ³¨å†Œæˆ–æ·»åŠ å¾®ä¿¡HSTS08 è·å–å…è´¹å…‘æ¢ç  ğŸ\")\r\n            }\r\n          >\r\n            åŠ å…¥èƒ½é‡ç¤¾ç¾¤å…è´¹é¢†å– â†’\r\n          </a>\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // âœ… Step 2: æ˜¾ç¤ºç»“æœ\r\n  if (result) {\r\n    return (\r\n      <div className=\"talent-result\">\r\n        <h2>ğŸ§¬ å…³äºä½ çš„å¤©èµ‹ç±»å‹ï¼š{result.type}</h2>\r\n        <p className=\"talent-desc\">{result.description}</p>\r\n        <p className=\"talent-score\">ğŸ¯ æµ‹è¯•å¾—åˆ†ï¼š{result.score} / 10</p>\r\n        <button\r\n          onClick={() =>\r\n            onFinish ? onFinish(\"home\") : (window.location.href = \"/\")\r\n          }\r\n        >\r\n          è¿”å›ä¸»é¡µ\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // âœ… Step 3: ç­”é¢˜è¿‡ç¨‹\r\n  if (questions.length === 0) return <p>é¢˜ç›®åŠ è½½ä¸­...</p>;\r\n\r\n  const q = questions[step];\r\n\r\n  return (\r\n    <div className=\"talent-test\">\r\n      <h2>ğŸŒŸ è¶…å¼ºå¤©èµ‹æµ‹è¯•</h2>\r\n      <p>{q.question}</p>\r\n      <div className=\"options\">\r\n        {q.options.map((opt, idx) => (\r\n          <button key={idx} onClick={() => handleAnswer(opt.type)}>\r\n            {opt.text}\r\n          </button>\r\n        ))}\r\n      </div>\r\n      <p>è¿›åº¦ï¼š{step + 1} / {questions.length}</p>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["TalentTest","_ref","onFinish","redeemCode","setRedeemCode","useState","isVerified","setIsVerified","checking","setChecking","error","setError","questions","setQuestions","step","setStep","scores","setScores","result","setResult","handleVerify","async","trim","data","supabase","from","select","eq","maybeSingle","used","type","update","alert","useEffect","todayKey","Date","toISOString","split","cacheKey","concat","cached","localStorage","getItem","JSON","parse","selected","count","arguments","length","undefined","fullQuestions","sort","Math","random","slice","getRandomQuestions","setItem","stringify","generateResult","_sorted$","_sorted$0$","_sorted$2","_sorted$3","sorted","Object","entries","finalScores","a","b","topType","topScore","second","totalScore","values","reduce","typeLabel","description","descMap","getTalentDescription","score","user","insert","user_email","email","err","console","_jsxs","className","children","_jsx","placeholder","value","onChange","e","target","onClick","disabled","href","window","location","q","question","options","map","opt","idx","newScores","_objectSpread","handleAnswer","text"],"sourceRoot":""}