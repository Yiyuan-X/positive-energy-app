{"version":3,"file":"static/js/253.e8b6a343.chunk.js","mappings":"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","sources":["components/LovePossessivenessTestPro.jsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport fullQuestions from \"../data/lovePossessivenessQuestionsPro.json\";\r\nimport { supabase } from \"../lib/supabaseClient\";\r\nimport \"./LovePossessivenessTestPro.css\";\r\n\r\n// âœ… éšæœºæŠ½é¢˜å‡½æ•°\r\nfunction getRandomQuestions(count = 10) {\r\n  return fullQuestions.sort(() => 0.5 - Math.random()).slice(0, count);\r\n}\r\n\r\nexport default function LovePossessivenessTestPro({ onFinish }) {\r\n  // ğŸ¯ çŠ¶æ€ç®¡ç†\r\n  const [questions, setQuestions] = useState([]);\r\n  const [enteredCode, setEnteredCode] = useState(\"\");\r\n  const [unlocked, setUnlocked] = useState(false);\r\n  const [step, setStep] = useState(0);\r\n  const [score, setScore] = useState(0);\r\n  const [result, setResult] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [priceInfo, setPriceInfo] = useState({ price: 10, discount: 0.99 });\r\n\r\n  // âœ… è‡ªåŠ¨ç¼“å­˜å½“å¤©çš„éšæœºé¢˜ç›®\r\n  useEffect(() => {\r\n    const todayKey = new Date().toISOString().split(\"T\")[0];\r\n    const cacheKey = `loveTest_${todayKey}`;\r\n    const cached = localStorage.getItem(cacheKey);\r\n\r\n    if (cached) {\r\n      setQuestions(JSON.parse(cached));\r\n    } else {\r\n      const selected = getRandomQuestions(10);\r\n      setQuestions(selected);\r\n      localStorage.setItem(cacheKey, JSON.stringify(selected));\r\n      Object.keys(localStorage)\r\n        .filter((k) => k.startsWith(\"loveTest_\") && k !== cacheKey)\r\n        .forEach((oldKey) => localStorage.removeItem(oldKey));\r\n    }\r\n  }, []);\r\n\r\n  // ğŸ§¾ éªŒè¯å…‘æ¢ç \r\n  const handleUnlock = async (e) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n\r\n    const { data: code, error } = await supabase\r\n      .from(\"love_access_codes\")\r\n      .select(\"*\")\r\n      .eq(\"code\", enteredCode.trim().toUpperCase())\r\n      .maybeSingle();\r\n\r\n    if (error) {\r\n      alert(\"æ•°æ®åº“é”™è¯¯ï¼š\" + error.message);\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    if (!code) {\r\n      alert(\"âŒ å…‘æ¢ç æ— æ•ˆï¼Œè¯·é‡è¯•ã€‚\");\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    if (code.is_used) {\r\n      alert(\"âš ï¸ æ­¤å…‘æ¢ç å·²è¢«ä½¿ç”¨ï¼Œè¯·è´­ä¹°æ–°ç ã€‚\");\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    setPriceInfo({\r\n      price: code.price,\r\n      discount: code.discount_price,\r\n    });\r\n    setUnlocked(true);\r\n    setLoading(false);\r\n\r\n    // âœ… æ›´æ–°å…‘æ¢ç çŠ¶æ€ä¸ºå·²ä½¿ç”¨\r\n    await supabase\r\n      .from(\"love_access_codes\")\r\n      .update({ is_used: true, used_at: new Date() })\r\n      .eq(\"code\", code.code);\r\n  };\r\n\r\n  // ğŸ§© ç­”é¢˜é€»è¾‘\r\n  const handleAnswer = (value) => {\r\n    setScore((prev) => prev + value);\r\n    if (step + 1 < questions.length) {\r\n      setStep(step + 1);\r\n    } else {\r\n      generateResult(score + value);\r\n    }\r\n  };\r\n\r\n  // ğŸ’ ç”Ÿæˆç»“æœï¼ˆå·²æ‰©å……ä¸º200å­—è¯¦ç»†è§£è¯»ï¼‰\r\n  const generateResult = (finalScore) => {\r\n    let type = \"\",\r\n      desc = \"\",\r\n      advice = \"\";\r\n\r\n    if (finalScore <= 12) {\r\n      type = \"ğŸƒ å®‰å…¨ä¾æ‹ï¼ˆä½å æœ‰æ¬²ï¼‰\";\r\n      desc =\r\n        \"ä½ åœ¨æ„Ÿæƒ…ä¸­èƒ½ä¿æŒä¿¡ä»»ä¸ç‹¬ç«‹ï¼Œè¯´æ˜ä½ æ‹¥æœ‰è‰¯å¥½çš„å®‰å…¨æ„Ÿä¸è‡ªæˆ‘ä»·å€¼ã€‚ä½ æ‡‚å¾—åœ¨çˆ±ä¸­å°Šé‡å½¼æ­¤ç©ºé—´ï¼Œä¹Ÿæ„¿æ„çœŸè¯šè¡¨è¾¾éœ€æ±‚ã€‚ä½ ç›¸ä¿¡äº²å¯†ä¸æ˜¯å æœ‰ï¼Œè€Œæ˜¯è‡ªç”±ä¸­çš„è¿æ¥ã€‚ç»§ç»­ä¿æŒæ²Ÿé€šä¸è‡ªä¿¡ï¼Œä¸å› é¡ºåˆ©çš„å…³ç³»è€Œå¿½ç•¥ç»è¥ã€‚å®šæœŸåˆ†äº«æƒ…ç»ªã€è¡¨è¾¾æ„Ÿæ¿€ï¼Œå°†è®©ä½ ä»¬çš„å…³ç³»æ›´æ·±æ›´ç¨³ã€‚\";\r\n      advice = \"ç»§ç»­åŸ¹å…»è‡ªä¿¡ä¸æ²Ÿé€šï¼Œè®©çˆ±åœ¨è‡ªç”±ä¸­æµåŠ¨ã€‚\";\r\n    } else if (finalScore <= 20) {\r\n      type = \"ğŸŒ¸ ç„¦è™‘ä¾æ‹ï¼ˆä¸­åº¦å æœ‰æ¬²ï¼‰\";\r\n      desc =\r\n        \"ä½ æ¸´æœ›è¢«å…³æ³¨å’Œå›åº”ï¼Œå¯¹ä¼´ä¾£çš„æƒ…ç»ªå˜åŒ–å¾ˆæ•æ„Ÿã€‚å½“å¯¹æ–¹å†·æ·¡æˆ–è¿Ÿå›å¤æ—¶ï¼Œä½ å®¹æ˜“é™·å…¥ä¸å®‰ã€‚è¿™è¯´æ˜ä½ åœ¨æ„æƒ…æ„Ÿè¿æ¥ï¼Œä½†ä¹Ÿå¯èƒ½è¿‡åº¦æ‹…å¿ƒå¤±å»ã€‚å»ºè®®ä½ å­¦ä¼šåˆ†è¾¨çœŸå®çš„æƒ…ç»ªä¸å‡æƒ³çš„ææƒ§ï¼Œå¤šå»ºç«‹å†…åœ¨å®‰å…¨æ„Ÿã€‚å½“ä½ å­¦ä¼šç‹¬ç«‹æ„Ÿå—å¿«ä¹æ—¶ï¼Œçˆ±å°†æ›´è½»ç›ˆã€æ›´æœ‰åŠ›é‡ã€‚\";\r\n      advice = \"ä¿¡ä»»è‡ªå·±ï¼Œä¹Ÿä¿¡ä»»å…³ç³»çš„éŸ§æ€§ã€‚\";\r\n    } else if (finalScore <= 27) {\r\n      type = \"ğŸ”¥ å›é¿ä¾æ‹ï¼ˆé«˜å æœ‰æ¬²ï¼‰\";\r\n      desc =\r\n        \"ä½ è¡¨é¢ç‹¬ç«‹ç†æ€§ï¼Œä½†å†…å¿ƒå®³æ€•å¤±æ§æˆ–è¢«ä¼¤å®³ï¼Œæ‰€ä»¥ä¼šä¸‹æ„è¯†æ‹‰å¼€è·ç¦»ã€‚ä½ å¯èƒ½ä»¥æ§åˆ¶æˆ–å†·é™çš„æ–¹å¼ä¿æŠ¤è‡ªå·±ã€‚å»ºè®®ä½ é€æ­¥ç»ƒä¹ è¡¨è¾¾çœŸå®æ„Ÿå—ï¼Œå…è®¸ä»–äººé è¿‘ã€‚äº²å¯†å¹¶ä¸æ„å‘³ç€å¤±å»è‡ªç”±ï¼Œè€Œæ˜¯è®©ä¸¤äººéƒ½æ›´å®Œæ•´ã€‚è¯•ç€æ¥çº³è„†å¼±ï¼Œå®ƒæ˜¯è¿æ¥çš„èµ·ç‚¹ã€‚\";\r\n      advice = \"å°è¯•æ”¾ä¸‹é˜²å¤‡ï¼Œè®©æ¸©æŸ”è¿›å…¥ä½ çš„ç”Ÿæ´»ã€‚\";\r\n    } else {\r\n      type = \"ğŸ’˜ æ··ä¹±ä¾æ‹ï¼ˆè¶…é«˜å æœ‰æ¬²ï¼‰\";\r\n      desc =\r\n        \"ä½ åœ¨å…³ç³»ä¸­å¸¸é™·å…¥æ‹‰æ‰¯ï¼šæ¸´æœ›é è¿‘åˆå®³æ€•å—ä¼¤ã€‚çˆ±å¯¹ä½ æ¥è¯´æ—¢æ˜¯æ•‘èµä¹Ÿæ˜¯è€ƒéªŒã€‚ä½ å¯èƒ½ç»å†è¿‡å¿½å†·å¿½çƒ­çš„æƒ…æ„Ÿä½“éªŒï¼Œä½¿ä½ åœ¨ä¾èµ–ä¸é€€ç¼©é—´å¾˜å¾Šã€‚å»ºè®®ä½ å…ˆä»è‡ªæˆ‘ç–—æ„ˆå¼€å§‹ï¼Œç†è§£ææƒ§èƒŒåçš„éœ€æ±‚ï¼Œå»ºç«‹å†…åœ¨å®‰å…¨ã€‚åªæœ‰å½“ä½ èƒ½æ¸©æŸ”åœ°çˆ±è‡ªå·±ï¼Œæ‰èƒ½ç¨³ç¨³åœ°å»çˆ±åˆ«äººã€‚\";\r\n      advice = \"å…ˆç–—æ„ˆè‡ªå·±ï¼Œå†å»æ¸©æŸ”åœ°é è¿‘ä»–äººã€‚\";\r\n    }\r\n\r\n    setResult({ type, desc, advice });\r\n  };\r\n\r\n  // ğŸ”’ æœªè§£é”ç•Œé¢\r\n  if (!unlocked) {\r\n    return (\r\n      <div className=\"love-lock\">\r\n        <h2>ğŸ’˜ æ‹çˆ±å æœ‰æ¬²æµ‹è¯•ï¼ˆä¸“ä¸šç‰ˆï¼‰</h2>\r\n        <p>è¾“å…¥å…‘æ¢ç å³å¯å¼€å§‹æµ‹è¯•ï¼š</p>\r\n        <form onSubmit={handleUnlock}>\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"è¯·è¾“å…¥å…‘æ¢ç \"\r\n            value={enteredCode}\r\n            onChange={(e) => setEnteredCode(e.target.value)}\r\n            required\r\n          />\r\n          <button type=\"submit\" disabled={loading}>\r\n            {loading ? \"éªŒè¯ä¸­...\" : \"ğŸ”“ è§£é”æµ‹è¯•\"}\r\n          </button>\r\n        </form>\r\n        <div className=\"price-info\">\r\n          åŸä»·ï¼šÂ¥{priceInfo.price}ã€€é™æ—¶ä¼˜æƒ ï¼š<b>Â¥{priceInfo.discount}</b>\r\n        </div>\r\n        <p className=\"hint\">è¿˜æ²¡æœ‰å…‘æ¢ç ï¼Ÿè¯·è”ç³»ç®¡ç†å‘˜è´­ä¹° ğŸ’Œ</p>\r\n        <button onClick={onFinish} className=\"back-btn\">\r\n          è¿”å›\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // ğŸ§  æµ‹è¯•å®Œæˆç•Œé¢\r\n  if (result) {\r\n    return (\r\n      <div className=\"love-result\">\r\n        <h2>{result.type}</h2>\r\n        <p className=\"desc\">{result.desc}</p>\r\n        <pre className=\"advice\">{result.advice}</pre>\r\n        <button\r\n          onClick={() =>\r\n            onFinish ? onFinish(\"home\") : (window.location.href = \"/\")\r\n          }\r\n        >\r\n          è¿”å›ä¸»é¡µ\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // ğŸ§© ç­”é¢˜ä¸­\r\n  if (questions.length === 0) return <p>é¢˜ç›®åŠ è½½ä¸­...</p>;\r\n\r\n  const q = questions[step];\r\n\r\n  return (\r\n    <div className=\"love-test\">\r\n      <h2>ğŸ’˜ æ‹çˆ±å æœ‰æ¬²æµ‹è¯•</h2>\r\n      <p>{q.question}</p>\r\n      <div className=\"options\">\r\n        {q.options.map((opt, idx) => (\r\n          <button key={idx} onClick={() => handleAnswer(opt.value)}>\r\n            {opt.text}\r\n          </button>\r\n        ))}\r\n      </div>\r\n      <p>è¿›åº¦ï¼š{step + 1}/{questions.length}</p>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["LovePossessivenessTestPro","_ref","onFinish","questions","setQuestions","useState","enteredCode","setEnteredCode","unlocked","setUnlocked","step","setStep","score","setScore","result","setResult","loading","setLoading","priceInfo","setPriceInfo","price","discount","useEffect","todayKey","Date","toISOString","split","cacheKey","concat","cached","localStorage","getItem","JSON","parse","selected","count","arguments","length","undefined","fullQuestions","sort","Math","random","slice","getRandomQuestions","setItem","stringify","Object","keys","filter","k","startsWith","forEach","oldKey","removeItem","handleUnlock","async","e","preventDefault","data","code","error","supabase","from","select","eq","trim","toUpperCase","maybeSingle","alert","message","is_used","discount_price","update","used_at","generateResult","finalScore","type","desc","advice","_jsxs","className","children","_jsx","onSubmit","placeholder","value","onChange","target","required","disabled","onClick","window","location","href","q","question","options","map","opt","idx","handleAnswer","prev","text"],"sourceRoot":""}