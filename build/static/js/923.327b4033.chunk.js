"use strict";(self.webpackChunkpositive_energy_app=self.webpackChunkpositive_energy_app||[]).push([[923],{130:()=>{},923:(e,s,n)=>{n.r(s),n.d(s,{default:()=>d});var t=n(890),c=n(74),a=(n(130),n(602));function i(){const[e,s]=(0,t.useState)([]),[n,i]=(0,t.useState)("all"),[l,r]=(0,t.useState)(!1),[d,o]=(0,t.useState)(10),[u,h]=(0,t.useState)("");async function j(){try{r(!0);let e=c.N.from("love_feeling_access_codes").select("*").order("created_at",{ascending:!1});"unused"===n&&(e=e.eq("is_used",!1)),"used"===n&&(e=e.eq("is_used",!0));const{data:t,error:a}=await e;a?(console.error("\u274c Supabase \u67e5\u8be2\u5931\u8d25:",a.message),h("\u26a0\ufe0f \u6743\u9650\u4e0d\u8db3\u6216\u52a0\u8f7d\u5931\u8d25\uff1a"+a.message),s([])):s(t||[])}catch(e){console.error("\ud83d\udca5 \u5f02\u5e38:",e),h("\ud83d\udca5 \u52a0\u8f7d\u51fa\u9519\uff1a"+e.message)}finally{r(!1)}}return(0,t.useEffect)(()=>{j()},[n]),(0,a.jsxs)("div",{className:"love-admin",children:[(0,a.jsx)("h2",{children:"\ud83d\udc9e \u559c\u6b22\u6d4b\u8bd5\u5151\u6362\u7801\u7ba1\u7406"}),(0,a.jsxs)("div",{className:"actions",children:[(0,a.jsxs)("select",{value:n,onChange:e=>i(e.target.value),children:[(0,a.jsx)("option",{value:"all",children:"\u5168\u90e8"}),(0,a.jsx)("option",{value:"unused",children:"\u672a\u4f7f\u7528"}),(0,a.jsx)("option",{value:"used",children:"\u5df2\u4f7f\u7528"})]}),(0,a.jsx)("input",{type:"number",min:"1",max:"100",value:d,onChange:e=>o(Number(e.target.value))}),(0,a.jsx)("button",{onClick:async function(){try{r(!0);const{data:e,error:s}=await c.N.functions.invoke("generate-love-feeling-codes",{body:JSON.stringify({count:d})});s?(console.error("\u274c \u751f\u6210\u5931\u8d25:",s.message),h("\u274c \u751f\u6210\u5931\u8d25\uff1a"+s.message)):(h("\u2705 \u5df2\u751f\u6210 ".concat(d," \u4e2a\u559c\u6b22\u6d4b\u8bd5\u5151\u6362\u7801")),await j())}catch(e){console.error("\ud83d\udca5 \u8c03\u7528\u51fd\u6570\u5931\u8d25:",e),h("\ud83d\udca5 \u7f51\u7edc\u6216\u51fd\u6570\u9519\u8bef\uff1a"+e.message)}finally{r(!1)}},disabled:l,children:"\u26a1 \u751f\u6210\u5151\u6362\u7801"}),(0,a.jsx)("button",{onClick:function(){const s=[["code","price","discount_price","is_used","used_at"].join(","),...e.map(e=>[e.code,e.price,e.discount_price,e.is_used,e.used_at||""].join(","))].join("\n"),n=new Blob([s],{type:"text/csv"}),t=document.createElement("a");t.href=URL.createObjectURL(n),t.download="love_feeling_access_codes.csv",t.click()},children:"\ud83d\udce4 \u5bfc\u51fa CSV"})]}),u&&(0,a.jsx)("p",{className:"message",children:u}),l&&(0,a.jsx)("p",{children:"\u52a0\u8f7d\u4e2d..."}),!l&&e.length>0&&(0,a.jsxs)("table",{className:"code-table",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"\u5151\u6362\u7801"}),(0,a.jsx)("th",{children:"\u539f\u4ef7"}),(0,a.jsx)("th",{children:"\u4f18\u60e0\u4ef7"}),(0,a.jsx)("th",{children:"\u72b6\u6001"}),(0,a.jsx)("th",{children:"\u4f7f\u7528\u65f6\u95f4"})]})}),(0,a.jsx)("tbody",{children:e.map(e=>(0,a.jsxs)("tr",{className:e.is_used?"used":"unused",children:[(0,a.jsx)("td",{children:e.code}),(0,a.jsx)("td",{children:e.price}),(0,a.jsx)("td",{children:e.discount_price}),(0,a.jsx)("td",{children:e.is_used?"\u2705 \u5df2\u7528":"\ud83d\udd53 \u672a\u7528"}),(0,a.jsx)("td",{children:e.used_at?new Date(e.used_at).toLocaleString():"-"})]},e.code))})]})]})}const l=(0,t.lazy)(()=>n.e(277).then(n.bind(n,277))),r=(0,t.lazy)(()=>n.e(359).then(n.bind(n,359)));function d(){const[e,s]=(0,t.useState)(null),[n,d]=(0,t.useState)("codes");return(0,t.useEffect)(()=>{(async()=>{const{data:e}=await c.N.auth.getUser();if(null===e||void 0===e||!e.user)return alert("\u8bf7\u5148\u767b\u5f55"),void(window.location.href="/");const{data:n,error:t}=await c.N.from("profiles").select("role").eq("id",e.user.id).maybeSingle();if(t&&console.error("\u274c \u83b7\u53d6\u7528\u6237\u89d2\u8272\u5931\u8d25\uff1a",t.message),"admin"!==(null===n||void 0===n?void 0:n.role))return alert("\u274c \u60a8\u6ca1\u6709\u8bbf\u95ee\u540e\u53f0\u7684\u6743\u9650"),void(window.location.href="/");s(e.user)})()},[]),e?(0,a.jsxs)("div",{className:"admin-dashboard",children:[(0,a.jsx)("h2",{children:"\ud83d\udcbc \u7ba1\u7406\u540e\u53f0"}),(0,a.jsxs)("div",{className:"tabs",children:[(0,a.jsx)("button",{className:"codes"===n?"active":"",onClick:()=>d("codes"),children:"\ud83c\udf81 \u5360\u6709\u6b32\u6d4b\u8bd5\u5151\u6362\u7801"}),(0,a.jsx)("button",{className:"loveFeelingCodes"===n?"active":"",onClick:()=>d("loveFeelingCodes"),children:"\ud83d\udc9e \u559c\u6b22\u6d4b\u8bd5\u5151\u6362\u7801"}),(0,a.jsx)("button",{className:"orders"===n?"active":"",onClick:()=>d("orders"),children:"\ud83d\udce6 \u8ba2\u5355\u7ba1\u7406"})]}),(0,a.jsxs)(t.Suspense,{fallback:(0,a.jsx)("p",{style:{textAlign:"center"},children:"\u52a0\u8f7d\u4e2d..."}),children:["codes"===n&&(0,a.jsx)(l,{}),"loveFeelingCodes"===n&&(0,a.jsx)(i,{}),"orders"===n&&(0,a.jsx)(r,{})]})]}):(0,a.jsx)("p",{style:{textAlign:"center"},children:"\u6b63\u5728\u9a8c\u8bc1\u6743\u9650..."})}}}]);
//# sourceMappingURL=923.327b4033.chunk.js.map