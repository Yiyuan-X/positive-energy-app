"use strict";(self.webpackChunkpositive_energy_app=self.webpackChunkpositive_energy_app||[]).push([[359],{359:(e,t,n)=>{n.r(t),n.d(t,{default:()=>r});var s=n(890),a=n(198);var l=n(602);function i(e){let{onLogin:t}=e;const[n,i]=(0,s.useState)(""),[r,o]=(0,s.useState)(""),[d,c]=(0,s.useState)(!1),[u,h]=(0,s.useState)("");return(0,l.jsx)("div",{className:"login-page",children:(0,l.jsxs)("div",{className:"login-card",children:[(0,l.jsx)("h2",{children:"\ud83d\udd10 \u540e\u53f0\u767b\u5f55"}),(0,l.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),c(!0),h("");const{data:s,error:l}=await a.N.auth.signInWithPassword({email:n,password:r});l?h("\u274c \u767b\u5f55\u5931\u8d25\uff1a"+l.message):(h("\u2705 \u767b\u5f55\u6210\u529f\uff0c\u6b63\u5728\u8fdb\u5165\u540e\u53f0..."),setTimeout(()=>t(s.user),1e3)),c(!1)},children:[(0,l.jsx)("input",{type:"email",placeholder:"\u90ae\u7bb1",value:n,onChange:e=>i(e.target.value),required:!0}),(0,l.jsx)("input",{type:"password",placeholder:"\u5bc6\u7801",value:r,onChange:e=>o(e.target.value),required:!0}),(0,l.jsx)("button",{type:"submit",disabled:d,children:d?"\u767b\u5f55\u4e2d...":"\u767b\u5f55"})]}),u&&(0,l.jsx)("p",{className:"login-msg",children:u})]})})}function r(){const{user:e,profile:t,loading:n,signOut:r}=function(){const[e,t]=(0,s.useState)(null),[n,l]=(0,s.useState)(null),[i,r]=(0,s.useState)(!0);async function o(e){const{data:t,error:n}=await a.N.from("profiles").select("email, full_name, role, avatar_url, created_at").eq("id",e).single();!n&&t?l(t):console.warn("\u26a0\ufe0f \u65e0\u6cd5\u52a0\u8f7d\u7528\u6237\u8d44\u6599\uff1a",null===n||void 0===n?void 0:n.message)}return(0,s.useEffect)(()=>{(async()=>{var e;const{data:n}=await a.N.auth.getSession(),s=(null===n||void 0===n||null===(e=n.session)||void 0===e?void 0:e.user)||null;t(s),s?await o(s.id):l(null),r(!1)})();const{data:e}=a.N.auth.onAuthStateChange((e,n)=>{const s=(null===n||void 0===n?void 0:n.user)||null;t(s),s?o(s.id):l(null)});return()=>e.subscription.unsubscribe()},[]),{user:e,profile:n,loading:i,signOut:async function(){await a.N.auth.signOut(),t(null),l(null)}}}(),[o,d]=(0,s.useState)([]),[c,u]=(0,s.useState)("all"),[h,p]=(0,s.useState)(!1),[x,v]=(0,s.useState)(""),[j,m]=(0,s.useState)("");if(n)return(0,l.jsx)("p",{style:{textAlign:"center"},children:"\u52a0\u8f7d\u4e2d..."});if(!e)return(0,l.jsx)(i,{});if("admin"!==(null===t||void 0===t?void 0:t.role))return(0,l.jsxs)("div",{style:{textAlign:"center",marginTop:"100px"},children:[(0,l.jsx)("h2",{children:"\ud83d\udeab \u65e0\u6743\u8bbf\u95ee"}),(0,l.jsx)("p",{children:"\u8bf7\u4f7f\u7528\u7ba1\u7406\u5458\u8d26\u53f7\u767b\u5f55\u3002"}),(0,l.jsx)("button",{style:{marginTop:"20px",background:"#f6d365",border:"none",padding:"10px 20px",borderRadius:"10px",cursor:"pointer"},onClick:r,children:"\u9000\u51fa\u767b\u5f55"})]});(0,s.useEffect)(()=>{!async function(){p(!0);let e=a.N.from("love_orders").select("\n        id,\n        order_no,\n        total_fee,\n        status,\n        pay_time,\n        transaction_id,\n        created_at,\n        love_access_codes(code)\n      ").order("created_at",{ascending:!1});"all"!==c&&(e=e.eq("status",c));const{data:t,error:n}=await e;n?v("\u274c \u52a0\u8f7d\u5931\u8d25\uff1a"+n.message):d(t||[]),p(!1)}()},[c]);const g=o.filter(e=>e.order_no.toLowerCase().includes(j.toLowerCase()));return(0,l.jsxs)("div",{className:"love-orders-admin",children:[(0,l.jsxs)("div",{className:"admin-header",children:[(0,l.jsx)("h2",{children:"\ud83d\udcb3 \u652f\u4ed8\u8ba2\u5355\u7ba1\u7406\u540e\u53f0"}),(0,l.jsxs)("div",{className:"admin-info",children:[(0,l.jsxs)("span",{children:["\u7ba1\u7406\u5458\uff1a",(null===t||void 0===t?void 0:t.full_name)||(null===t||void 0===t?void 0:t.email)]}),(0,l.jsx)("button",{onClick:r,className:"logout-btn",children:"\u9000\u51fa\u767b\u5f55"})]})]}),(0,l.jsxs)("div",{className:"top-bar",children:[(0,l.jsxs)("div",{className:"filters",children:[(0,l.jsxs)("select",{value:c,onChange:e=>u(e.target.value),children:[(0,l.jsx)("option",{value:"all",children:"\u5168\u90e8\u8ba2\u5355"}),(0,l.jsx)("option",{value:"pending",children:"\u5f85\u652f\u4ed8"}),(0,l.jsx)("option",{value:"paid",children:"\u5df2\u652f\u4ed8"}),(0,l.jsx)("option",{value:"failed",children:"\u652f\u4ed8\u5931\u8d25"})]}),(0,l.jsx)("input",{type:"text",placeholder:"\ud83d\udd0d \u641c\u7d22\u8ba2\u5355\u53f7",value:j,onChange:e=>m(e.target.value)})]}),(0,l.jsx)("button",{className:"export-btn",onClick:()=>{const e=[["\u8ba2\u5355\u53f7","\u91d1\u989d(\u5143)","\u72b6\u6001","\u4ea4\u6613\u53f7","\u5151\u6362\u7801","\u652f\u4ed8\u65f6\u95f4"],...g.map(e=>{var t;return[e.order_no,(e.total_fee/100).toFixed(2),e.status,e.transaction_id||"-",(null===(t=e.love_access_codes)||void 0===t?void 0:t.code)||"-",e.pay_time?new Date(e.pay_time).toLocaleString():"-"]})].map(e=>e.join(",")).join("\n"),t=new Blob([e],{type:"text/csv"}),n=document.createElement("a");n.href=URL.createObjectURL(t),n.download="love_orders_".concat((new Date).toISOString().split("T")[0],".csv"),n.click()},children:"\ud83d\udce4 \u5bfc\u51fa CSV"})]}),x&&(0,l.jsx)("p",{className:"message",children:x}),h?(0,l.jsx)("p",{children:"\u52a0\u8f7d\u4e2d..."}):(0,l.jsxs)("table",{className:"orders-table",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"\u8ba2\u5355\u53f7"}),(0,l.jsx)("th",{children:"\u91d1\u989d"}),(0,l.jsx)("th",{children:"\u72b6\u6001"}),(0,l.jsx)("th",{children:"\u4ea4\u6613\u53f7"}),(0,l.jsx)("th",{children:"\u5151\u6362\u7801"}),(0,l.jsx)("th",{children:"\u652f\u4ed8\u65f6\u95f4"}),(0,l.jsx)("th",{children:"\u521b\u5efa\u65f6\u95f4"})]})}),(0,l.jsx)("tbody",{children:g.map(e=>{var t;return(0,l.jsxs)("tr",{className:e.status,children:[(0,l.jsx)("td",{children:e.order_no}),(0,l.jsxs)("td",{children:["\xa5",(e.total_fee/100).toFixed(2)]}),(0,l.jsx)("td",{children:"paid"===e.status?"\u2705 \u5df2\u652f\u4ed8":"pending"===e.status?"\u23f3 \u5f85\u652f\u4ed8":"\u274c \u5931\u8d25"}),(0,l.jsx)("td",{children:e.transaction_id||"-"}),(0,l.jsx)("td",{children:(null===(t=e.love_access_codes)||void 0===t?void 0:t.code)||"-"}),(0,l.jsx)("td",{children:e.pay_time?new Date(e.pay_time).toLocaleString():"-"}),(0,l.jsx)("td",{children:new Date(e.created_at).toLocaleString()})]},e.id)})})]})]})}}}]);
//# sourceMappingURL=359.1ecf0ea5.chunk.js.map